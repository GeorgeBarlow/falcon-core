{"version":3,"sources":["../src/typeMapper.js"],"names":["GraphQLInt","GraphQLString","GraphQLBoolean","GraphQLFloat","GraphQLEnumType","GraphQLList","JSONType","_","customTypeMapper","mapType","mapFunc","toGraphQL","sequelizeType","sequelizeTypes","result","BOOLEAN","ENUM","FLOAT","CHAR","DECIMAL","DOUBLE","INTEGER","BIGINT","STRING","TEXT","UUID","DATE","DATEONLY","TIME","ARRAY","VIRTUAL","JSON","specialCharsMap","Map","elementType","type","name","values","mapKeys","sanitizeEnumValue","mapValues","v","value","returnType","console","log","key","_graphql","Error","toSql","trim","replace","p","get","split","map","i","upperFirst","join"],"mappings":"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","file":"typeMapper.js","sourcesContent":["import {\n   GraphQLInt,\n   GraphQLString,\n   GraphQLBoolean,\n   GraphQLFloat,\n   GraphQLEnumType,\n   GraphQLList\n } from 'graphql';\nimport JSONType from './types/jsonType';\nimport _ from 'lodash';\n\nlet customTypeMapper;\n/**\n * A function to set a custom mapping of types\n * @param {Function} mapFunc\n */\nexport function mapType(mapFunc) {\n  customTypeMapper = mapFunc;\n}\n\n\n/**\n * Checks the type of the sequelize data type and\n * returns the corresponding type in GraphQL\n * @param  {Object} sequelizeType\n * @param  {Object} sequelizeTypes\n * @return {Function} GraphQL type declaration\n */\nexport function toGraphQL(sequelizeType, sequelizeTypes) {\n\n  // did the user supply a mapping function?\n  // use their mapping, if it returns truthy\n  // else use our defaults\n  if (customTypeMapper) {\n    let result = customTypeMapper(sequelizeType);\n    if (result) return result;\n  }\n\n  const {\n    BOOLEAN,\n    ENUM,\n    FLOAT,\n    CHAR,\n    DECIMAL,\n    DOUBLE,\n    INTEGER,\n    BIGINT,\n    STRING,\n    TEXT,\n    UUID,\n    DATE,\n    DATEONLY,\n    TIME,\n    ARRAY,\n    VIRTUAL,\n    JSON\n  } = sequelizeTypes;\n\n  // Map of special characters\n  const specialCharsMap = new Map([\n    ['¼', 'frac14'],\n    ['½', 'frac12'],\n    ['¾', 'frac34']\n  ]);\n\n  if (sequelizeType instanceof BOOLEAN) return GraphQLBoolean;\n\n  if (sequelizeType instanceof FLOAT ||\n      sequelizeType instanceof DOUBLE) return GraphQLFloat;\n\n  if (sequelizeType instanceof INTEGER) {\n    return GraphQLInt;\n  }\n\n  if (sequelizeType instanceof CHAR ||\n      sequelizeType instanceof STRING ||\n      sequelizeType instanceof TEXT ||\n      sequelizeType instanceof UUID ||\n      sequelizeType instanceof DATE ||\n      sequelizeType instanceof DATEONLY ||\n      sequelizeType instanceof TIME ||\n      sequelizeType instanceof BIGINT ||\n      sequelizeType instanceof DECIMAL) {\n    return GraphQLString;\n  }\n\n  if (sequelizeType instanceof ARRAY) {\n    let elementType = toGraphQL(sequelizeType.type, sequelizeTypes);\n    return new GraphQLList(elementType);\n  }\n\n  if (sequelizeType instanceof ENUM) {\n    return new GraphQLEnumType({\n      name: 'tempEnumName',\n      values: _(sequelizeType.values)\n        .mapKeys(sanitizeEnumValue)\n        .mapValues(v => ({value: v}))\n        .value()\n    });\n  }\n\n  if (sequelizeType instanceof VIRTUAL) {\n    let returnType = sequelizeType.returnType\n        ? toGraphQL(sequelizeType.returnType, sequelizeTypes)\n        : GraphQLString;\n    return returnType;\n  }\n\n  if (sequelizeType instanceof JSON) {\n    return JSONType;\n  }\n\n  console.log(sequelizeType)\n\n  if (sequelizeType.key === 'BLOB') {\n    return _graphql.GraphQLString\n  }\n\n  throw new Error(`Unable to convert ${sequelizeType.key || sequelizeType.toSql()} to a GraphQL type`);\n\n  function sanitizeEnumValue(value) {\n    return value\n      .trim()\n      .replace(/([^_a-zA-Z0-9])/g, (_, p) => specialCharsMap.get(p) || ' ')\n      .split(' ')\n      .map((v, i) => i ? _.upperFirst(v) : v)\n      .join('')\n      .replace(/(^\\d)/, '_$1');\n  }\n}\n"]}