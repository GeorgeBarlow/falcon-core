{"version":3,"sources":["../src/Utils.js"],"names":["homedir","getConfigPath","fileExists","fileExistsSync","writeFile","writeJSONFile","writeJSONFileSync","resolveHomePathToAbsolute","readFile","readJSONFile","readJSONFileSync","getPort","createCancelablePromise","process","env","platform","NODE_ENV","path","join","__dirname","filename","Promise","resolve","fs","stat","err","stats","isFile","statSync","e","data","reject","JSON","stringify","writeFileSync","test","substring","filePath","toString","then","parse","readFileSync","enconding","pf","host","port","wait","time","setTimeout","error","timeIdle","canceled","discarded","Error","message","Object","getOwnPropertyNames","forEach","key","cancel","discard"],"mappings":"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","file":"Utils.js","sourcesContent":["// @flow\nimport fs from 'fs';\nimport path from 'path';\nimport pf from 'portfinder';\n\nexport function homedir() {\n  return (\n    process.env[process.platform === 'win32' ? 'USERPROFILE' : 'HOME'] || 'HOME'\n  );\n}\n\nexport function getConfigPath() {\n  return process.env.NODE_ENV === 'test'\n    ? path.join(__dirname, '..', 'test', 'fixtures', '.tmp.sqlectron.json')\n    : path.join(homedir(), '.sqlectron.json');\n}\n\nexport function fileExists(filename: string): Promise<boolean> {\n  return new Promise(resolve => {\n    fs.stat(filename, (err, stats) => {\n      if (err) return resolve(false);\n      return resolve(stats.isFile());\n    });\n  });\n}\n\nexport function fileExistsSync(filename: string) {\n  try {\n    return fs.statSync(filename).isFile();\n  } catch (e) {\n    return false;\n  }\n}\n\nexport function writeFile(filename: string, data: string): Promise<void> {\n  return new Promise((resolve, reject) => {\n    fs.writeFile(filename, data, err => {\n      if (err) return reject(err);\n      return resolve();\n    });\n  });\n}\n\nexport function writeJSONFile(filename: string, data: Object) {\n  return writeFile(filename, JSON.stringify(data, null, 2));\n}\n\nexport function writeJSONFileSync(filename: string, data: Object) {\n  return fs.writeFileSync(filename, JSON.stringify(data, null, 2));\n}\n\nexport function resolveHomePathToAbsolute(filename: string) {\n  if (!/^~\\//.test(filename)) {\n    return filename;\n  }\n\n  return path.join(homedir(), filename.substring(2));\n}\n\nexport function readFile(filename: string): Promise<string> {\n  const filePath = resolveHomePathToAbsolute(filename);\n  return new Promise((resolve, reject) => {\n    fs.readFile(path.resolve(filePath), (err, data) => {\n      if (err) return reject(err);\n      return resolve(data.toString());\n    });\n  });\n}\n\nexport function readJSONFile(filename: string): Promise<Object> {\n  return readFile(filename).then(data => JSON.parse(data));\n}\n\nexport function readJSONFileSync(filename: string) {\n  const filePath = resolveHomePathToAbsolute(filename);\n  const data = fs.readFileSync(path.resolve(filePath), { enconding: 'utf-8' });\n  return JSON.parse(data.toString());\n}\n\nexport function getPort(): Promise<number> {\n  return new Promise((resolve, reject) => {\n    pf.getPort({ host: 'localhost' }, (err, port) => {\n      if (err) return reject(err);\n      return resolve(port);\n    });\n  });\n}\n\nconst wait = time => new Promise(resolve => setTimeout(resolve, time));\n\nexport function createCancelablePromise(error: Error, timeIdle: number = 100) {\n  let canceled = false;\n  let discarded = false;\n\n  return {\n    async wait() {\n      while (!canceled && !discarded) {\n        await wait(timeIdle);\n      }\n\n      if (canceled) {\n        const err = new Error(error.message || 'Promise canceled.');\n\n        Object.getOwnPropertyNames(error).forEach(\n          key => (err[key] = error[key])\n        );\n\n        throw new Error(err);\n      }\n    },\n    cancel() {\n      canceled = true;\n    },\n    discard() {\n      discarded = true;\n    }\n  };\n}\n"]}